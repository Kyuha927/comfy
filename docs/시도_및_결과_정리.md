# 캐릭터 파이프라인 시도 및 결과 정리

## 1. 초기 (최초 구현)

| 항목 | 설정 |
|------|------|
| 해상도 | 96×96 |
| denoise | 0.85 (플레이스홀더) |
| steps | 25 |
| cfg | 7.5 |
| sampler | euler, normal |
| 프롬프트 | base_prompt + parts (hair, top, bottom, shoes, item, expression) |
| 체크포인트 | tendertroupe → 실패 후 pixelstyleckpt_strength07 |

**결과:**  
- 사용자: "결과가 왜 이래 근데"  
- 원인: 파츠(blue pants, white sneakers) 반영 부족, 흐릿함, 픽셀 아트 느낌 부족  

---

## 2. 첫 번째 개선 (제안대로)

| 항목 | 변경 |
|------|------|
| 해상도 | 96 → **128×128** |
| denoise | **0.78** |
| steps | **28** |
| cfg | **8.5** |
| 프롬프트 | sharp edges, 1px outline, no anti-aliasing 추가 |
| parts | "red jacket only", "blue pants only, wearing blue pants", "white sneakers only, white shoes" |
| negative | blur, soft, gradient, smooth shading, anti-aliasing, soft edges 추가 |

**결과:**  
- `hero_01_..._00001_.png` (128×128)  
- 해상도·선명도는 나아짐  

---

## 3. 해상도 더 올림 (다시 돌려봐)

| 항목 | 변경 |
|------|------|
| 해상도 | 128 → **192×192** |
| steps | **35** |
| cfg | **9** |

**결과:**  
- `hero_01_..._00002_.png` (192×192)  
- 사용자: "해상도는 점점 올라가는데 **그림이 깨지네**"  
- 원인: 픽셀/캐릭터 체크포인트가 192에서 불안정  

---

## 4. 깨짐 완화 (128으로 복귀)

| 항목 | 변경 |
|------|------|
| 해상도 | 192 → **128×128** |
| denoise | **0.78** 유지 |
| cfg | **8.5** |
| steps | **28** |

**결과:**  
- `hero_01_..._00003_.png` (128×128)  
- 깨짐 줄고 안정화  

---

## 5. 웹 학습 반영 (SD 1.5 네이티브)

| 항목 | 변경 |
|------|------|
| 해상도 | 128 → **512×512** (SD 1.5 권장) |
| denoise | 0.78 → **1.0** (txt2img 표준) |
| steps | **25** |
| cfg | **7.5** |
| sampler | euler, normal |

**결과:**  
- `hero_01_..._00004_.png` (512×512)  
- 사용자: "**점점 좋아지고 있어**"  
- 512에서 품질·구도 개선  

---

## 6. 샘플러·프롬프트 다듬기 (더 개선)

| 항목 | 변경 |
|------|------|
| sampler | euler → **euler_ancestral**, normal → **karras** |
| steps | **28** |
| cfg | **8** |
| base_prompt | **game character sprite**, chibi, standing pose, **centered**, **single character only**, **flat colors** 추가 |
| negative | **multiple characters, cropped, bad anatomy, extra limbs, deformed** 추가 |
| parts | "only" 등 제거해 **red jacket, blue pants, white sneakers** 로 단순화 |

**결과:**  
- `hero_01_short_black_hair_red_jacket_blue_pants_white_sneakers_empty_neutral_00002_.png`  
- 파일명 단순화, 품질 유지·개선  

---

## 7. dpmpp_2m + 품질 키워드 (또 개선)

| 항목 | 변경 |
|------|------|
| sampler | euler_ancestral → **dpmpp_2m**, scheduler **karras** |
| steps | **30** |
| cfg | **8.5** |
| base_prompt | **masterpiece, best quality**, **clear silhouette**, **readable pose** 추가 |
| negative | **lowres, worst quality**, **jpeg artifacts** 추가 |

**결과:**  
- `hero_01_short_black_hair_red_jacket_blue_pants_white_sneakers_empty_neutral_00003_.png`  
- 샘플러·품질 키워드로 마무리 단계  

---

## 8. Identity Lock 전환 (img2img 기반)

| 항목 | 변경 |
|------|------|
| 방식 | txt2img 단일 패스 → **기준 이미지 1장 + img2img로 파츠만 변경** |
| denoise (img2img) | **0.35 ~ 0.45** (권장 0.4) |
| cfg (img2img) | **6.5 ~ 7** (권장 6.75) |
| 프롬프트 | **금지**: masterpiece, best quality, ultra detailed |
| | **허용**: pixel game character sprite, flat colors, simple shading, clear outline, game asset, front view, standing pose |
| 설정 | `base_image`에 기준 이미지 경로 지정 시 img2img, 비우면 txt2img 1회 |

**결과:**  
- 캐릭터 아이덴티티(얼굴·눈·비율·체형)는 **이미지가 결정**, 프롬프트는 파츠만 기술.  
- 상세: [img2img_identity_lock_pipeline.md](img2img_identity_lock_pipeline.md)

---

## 요약 표

| 단계 | 해상도 | denoise | steps | cfg | sampler | 사용자 반응 |
|------|--------|---------|-------|-----|---------|-------------|
| 1 초기 | 96 | 0.85 | 25 | 7.5 | euler | 결과 불만 |
| 2 | 128 | 0.78 | 28 | 8.5 | euler | 개선됨 |
| 3 | 192 | - | 35 | 9 | euler | **그림 깨짐** |
| 4 | 128 | 0.78 | 28 | 8.5 | euler | 안정화 |
| 5 | **512** | **1.0** | 25 | 7.5 | euler | **좋아짐** |
| 6 | 512 | 1.0 | 28 | 8 | euler_ancestral+karras | 유지·개선 |
| 7 | 512 | 1.0 | 30 | 8.5 | **dpmpp_2m**+karras | 최종 개선 |
| 8 Identity Lock | 512 | **0.4** (img2img) | 25 | **6.75** | dpmpp_2m+karras | 일관성·자산화 |

---

## 교훈

1. **해상도:** SD 1.5는 512×512가 안정적. 96/128/192는 깨짐·불안정 위험.  
2. **denoise:** txt2img는 **1.0** 사용. 1 미만은 img2img용.  
3. **샘플러:** dpmpp_2m + karras가 품질·일관성에 유리.  
4. **프롬프트:** masterpiece, best quality, clear silhouette, single character, flat colors 등이 게임 스프라이트에 도움.  
5. **negative:** lowres, worst quality, multiple characters, bad anatomy 등으로 품질·구도 보정.

---

## 현재 최종 설정 (기준)

- **txt2img (베이스 1회):** `node_templates/pixel_character.json` — 512×512, denoise 1, steps 30, cfg 8.5, dpmpp_2m, karras.  
- **img2img (파츠 변경):** `node_templates/img2img_character.json` — denoise 0.4, steps 25, cfg 6.75, dpmpp_2m, karras.  
- **configs/example_character.json:** `base_image` 비우면 txt2img, 경로 넣으면 img2img. base_prompt는 목적형 키워드만 (금지: masterpiece, best quality, ultra detailed).

출력 파일은 `outputs/` 에 `hero_01_{hair}_{top}_{bottom}_{shoes}_{item}_{expression}_0000N_.png` 형식으로 저장됨.
