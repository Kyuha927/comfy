# "Connection refused" / 연결 거부 오류

## 왜 이 오류가 나오나요?

```
requests.exceptions.ConnectionError: ... Failed to establish a new connection ...
[WinError 10061] 대상 컴퓨터에서 연결을 거부했으므로 연결하지 못했습니다
```

**이 메시지는 "ComfyUI 서버가 그 주소(127.0.0.1:8188)에서 응답하지 않는다"는 뜻입니다.**

- 파이프라인(GUI/배치)은 **ComfyUI가 이미 켜져 있고**, 지정한 포트(기본 8188)에서 **HTTP로 대기 중**이라고 가정합니다.
- ComfyUI를 **아직 실행하지 않았거나**, **다른 포트**(예: 8000)에서 돌고 있으면 위 오류가 납니다.

---

## 해결 방법

### 1. ComfyUI를 먼저 실행하기

1. ComfyUI 설치 폴더로 이동합니다.
2. `python main.py` 또는 사용하는 실행 파일(`run_nvidia_gpu.bat` 등)로 **ComfyUI를 켭니다.**
3. CMD/터미널에 `Running on http://127.0.0.1:XXXX` 같은 문구가 나오면 **그 포트 번호**를 기억합니다.

### 2. 포트 확인하기

- 브라우저에서 **http://127.0.0.1:8188** 을 열어봅니다.
  - ComfyUI 화면이 보이면 → **8188** 사용 중. 파이프라인 서버 주소는 그대로 `http://127.0.0.1:8188` 로 두면 됩니다.
- 8188이 안 열리면 **http://127.0.0.1:8000** 을 열어봅니다.
  - 여기서 ComfyUI가 보이면 → **8000** 사용 중. 아래처럼 **서버 주소를 8000으로** 바꿔야 합니다.

### 3. 파이프라인에서 서버 주소 바꾸기

**GUI 사용 시**

- "ComfyUI 서버" 입력란을 `http://127.0.0.1:8000` 으로 수정한 뒤 **연결 확인** 버튼으로 확인 후 실행.

**배치 파일 사용 시**

- `run_pipeline.bat` 를 열고 다음 한 줄을 수정합니다.
  ```bat
  set COMFY_SERVER=http://127.0.0.1:8000
  ```

### 4. 구동 확인 스크립트

- 터미널에서 `python check_comfyui.py` 를 실행하면 8188/8000 연결 여부를 한 번에 확인할 수 있습니다.
- 한 포트라도 "OK - 연결됨"이 나온 뒤에, 그 주소를 GUI/배치에 넣어 사용하면 됩니다.

---

**정리:** 오류가 계속 뜨는 이유는 **ComfyUI가 꺼져 있거나, 파이프라인이 접속하는 포트(8188)와 ComfyUI가 실제로 쓰는 포트(예: 8000)가 다르기 때문**입니다. ComfyUI를 먼저 켜고, 브라우저로 포트를 확인한 뒤, 같은 주소를 파이프라인에 넣으면 해결됩니다.
